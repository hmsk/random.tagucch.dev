---
title: '続・contents内部のディレクトリ構造を変更したい'
date: '2021-07-25'
tags: ['Node.js']
---

## 続・ディレクトリ構造変更

[昨日](/posts/2021-07-24)に引き続きディレクトリ構造を変更をした。

[ディレクトリ構成の変更 by tagucch · Pull Request \#25 · tagucch/random\.tagucch\.dev](https://github.com/tagucch/random.tagucch.dev/pull/25)

昨日はめちゃくちゃしょうもないミスで詰まってて、ディレクトリの名前が複数渡ってくるんだからそれらに対してループでファイル名取ってこなきゃいけないんだけど、昨日はなぜかそれがすっぽり頭から抜けてて進まんと唸っていた。アホすぎる。

`fs.Dirent[]`から`dirNames`を取り出して、それらに対して`fs.readdirSync(dirName)`でディレクトリ内のファイルを取り出して、さらにそれらのファイルひとつひとつを処理するので、二重ループになってしまったけど、構造上仕方ない気もする。誰かもっといいコードの書き方があったら教えてほしい。

また、map の中で map してるので結果が`Post[][]`みたいな Array 要素を持つ Array になってて、最後に`flat()`してるんだけど、これも意味的に合ってるのか分からないしもっといい書き方がある気がするような。

あとは共通化をサボっているので、いろんな関数のいたるところに同じ処理があるのもよくない感じなのでリファクタリングしたい感じがする。

そして map で dirName や fileName を処理するところで`fs.readdirSync(dirName)`とか渡してエラーになったりしてたんだけど、`` `${postsDir}/${dirName}` ``とか毎回やっていて、これももっとうまいやりかたないかな〜と思っている。

そしてインライン表示でバッククォート表示させるのどうやるんだっけと思ったら[6/2 の投稿](/posts/2021-06-02)に自分で書いていた。こういうときに自分のメモ残してあると助かるな〜と感じる。
